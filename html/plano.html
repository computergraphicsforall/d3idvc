<!DOCTYPE html>
<html>
    <head>
        <!-- Computación gráfica -->
        <!-- Jorge Victorino, Miguel Barrero-->
        <title>Documento guia para Three.js</title>
        <!--Configuracion meta-->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

        <!-- Recursos basicos de three.js -->
        <!-- La ruta de estos recursos son relativos dependiendo en donde usted los tenga -->
        <script type="text/javascript" src="../three.js/build/three.js"></script>
	    <script type="text/javascript" src="../three.js/examples/js/controls/OrbitControls.js"></script>
    </head>
    <body>
        <script type="text/javascript">
            //http://math.hws.edu/graphicsbook/index.html Libro de computación grafica, en linea y gratis

            var renderer, scene, camera, light1, light2, controls;
            var planeGeo, x, y, factor=0.05, flag=true, noise;

            initScene();
            animate();
            gui();

            function initScene() {
                scene = new THREE.Scene();
                scene.background = new THREE.Color('slategray');

                renderer = new THREE.WebGLRenderer( {antialias:true} );
                renderer.setSize(window.innerWidth, window.innerHeight);
                document.body.appendChild(renderer.domElement)

                camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
                camera.position.set(10, 0, 10);
                camera.lookAt(0,0,0);
                camera.up.set(0, 0, 1);

                light1 = new THREE.PointLight('gold');
                light1.position.set(-20, 0, 20);

                light2 = new THREE.PointLight('tomato' );
                light2.position.set(20, 0, -20);

                controls = new THREE.OrbitControls(camera, renderer.domElement)
                controls.addEventListener('change', renderer)

                x = 100;
                y = 100;

                planeGeo = new THREE.PlaneGeometry( 2, 2, x, y );
                planeGeo.computeFaceNormals();
                planeGeo.computeVertexNormals();

                const planeMat = new THREE.MeshPhongMaterial({color:'white', specular:'white', side:THREE.DoubleSide, shininess:2024, wireframe:false});

                const plane = new THREE.Mesh(planeGeo, planeMat);

                const axis = new THREE.AxesHelper(2);
                //var vnh = new THREE.VertexNormalsHelper( plane, 0.01, 0xff0000 );
                noise = genNoise();

                scene.add(axis);
                //scene.add( vnh );
                scene.add(plane)
                scene.add(light1)
                scene.add(light2)
            }

            function genNoise(){
                let arr = [];
                for (let i=0; i<(x+1)*(y+1); i++) {
                    arr.push(Math.random() * 0.02)
                }
                return arr;
            }

            function render() {
                for(let i=0; i<=x; i++){
                    for(let j=0; j<=y; j++){
                        n = i*(x+1)+j;
                        xx = (2*i-x)/x;
                        yy = (2*j-y)/y;
                        //planeGeo.vertices[n].z = (xx*xx - yy*yy) * factor + noise[n];
                        planeGeo.vertices[n].z = Math.exp(-(xx*xx*5+yy*yy*3))*factor*2 //+ noise[n]
                        //planeGeo.vertices[n].z = (Math.cos(xx*7) + Math.cos(yy*7)+ noise[n])*factor*0.25
                    }
                }
                planeGeo.computeFaceNormals();
                planeGeo.computeVertexNormals();
                if(factor >= 1.0 || factor < -1) flag = !flag;
                if(flag){
                    factor += 0.004;
                }
                else {
                    factor -= 0.004;
                }
                planeGeo.verticesNeedUpdate = true;
                planeGeo.normalsNeedUpdate  = true;

                renderer.render(scene, camera)
            }

            function animate() {

                requestAnimationFrame(animate);
                render();
            }

            function gui() {

            }

        </script>
    </body>
</html>